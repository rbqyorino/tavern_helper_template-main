目前我想在sillytavern里制作一个模拟galgame界面，它能处理特定格式的文本，然后将其在聊天窗口内直接渲染成一个可交互的、动态的视觉小说（Galgame）场景。

具体功能：能够显示角色名称和对话内容且能理解用方括号 [...] 括起来的简单指令，用来控制场景中的各种元素。

场景管理:
[bg|图片链接或别名]: 设置或更换背景图片。支持淡入淡出等过渡效果。
[cg|图片链接或别名]: 显示一张CG（Computer Graphic），通常指用于关键剧情的全屏插画。
[bgm|${符合当前场景氛围的BGM}]：为当前场景播放背景音乐
并且还能像galgame一样出现角色的对话、立绘
有两种显示对话的格式：
旁白||${旁白内容}
${角色名}|${角色的位置(L1、L2、L3、L4)}|${角色的立绘名，若没有则留空}|${角色的对话，最后可附加动作指令, 如[action|角色名|shake]}
最后还有一个选择功能：
[choice|${选项一的内容}|${选项二的内容}|${选项三的内容}]: 暂停剧情，并在屏幕上显示几个可点击的选项按钮。当用户点击其中一个选项后，该选项的文本会自动作为用户的输入发送给AI，从而推动剧情发展。


一些解释：
- 旁白的因为没有立绘和位置，所以旁白的说话格式为`旁白||${具体内容}`
- 界面一次性最多四个角色，从左到右分别是L1、L2、L3、L4
- “[choice|${选项1}|${选项2}|${选项3}]”为玩家可以点击选项，然后在sillytavern的输入框内容输入选择的选项内容
- 需要将当前未说话的角色立绘自动变暗，突出正在说话的角色。

现在介绍一下运动特效：
- 角色抖动`shake`。指定角色的立绘产生晃动的动画效果，表达例如：害怕、生气、强调
- 角色向上跳`jump_up`。让角色立绘做一个向上跳动的动作，表达例如：惊讶、开心、被吓到
- 角色向下蹲`jump_down`。让角色立绘做一个向下蹲下的动作，表达例如：捡东西、躲藏、失落、表示肯定
- 角色立绘放大缩小`near`和`away`，角色的立绘会放大/缩小，表达例如：靠近、远离
- 地图切换：假设从A背景→B背景，B背景会从左往右逐渐替换掉A背景
- 音乐显示：界面最开始，右上角会弹窗出现此时的音乐名字，2s后弹窗消失
- 角色立绘出现/消失：角色立绘有淡入淡出特效
- CG的出现的位置应在对话框上方，不影响玩家观看对话框




对于这个界面，我有一其他想法：
---
基础界面：
整个前端界面最基础的部分是：背景、立绘、对话框、BGM。
基础部分设定：
- 立绘具有轻微的呼吸和运动特效（具体后面会提及）
- 加入立绘/去掉立绘时，用淡入淡出特效（地图同理）
- 对话框里的文字显示效果默认为打字机模式，并且打字过程中点击一下鼠标左键可以立刻显示出完整文字
- 对话框的美术设计可以参考“样例”文件夹内的美术风格
---
界面右上角还有一些功能图标（比如图标都在右上角，图标样式使用 Font Awesome 图标）：
- 有个音量设置，图标是是“<i class="fa-utility-fill fa-semibold fa-volume"></i>”。点击后显示播放的bgm（并且可以调整是否开启bgm与调整bgm的音量大小）、
- 查看对话日志，图标链接是“<i class="fa-utility-fill fa-semibold fa-comment"></i>”。点击后回顾已经发生过的对话历史，具体形式是“角色头像+对话内容”
- 有个设置功能，图标是链接是“<i class="fa-utility-fill fa-semibold fa-gear"></i>”，里面可以设置主题的白天/夜间模式、勾选是否为角色添加呼吸特效（为角色立绘添加微妙的呼吸动画效果）、选择是否可以让空格/方向键“↓”推进对话、设置文字设置（文字出现动画默认为打字机效果，玩家可以调整出字速度和字体大小，并且初始状态有默认值，玩家可以一键恢复默认状态）、是否开启文本自动播放（即一句话说话过一会自动下一句对话、且可以调整自动播放速度）
- 一个模式“隐藏”，是一个小圆圈，里面右个“隐”字。点击后保留此时的角色立绘和背景（gal游戏里的“查看模式”），然后图标变成“显”，点击后恢复到原来的状态。
- 可以的话，代码需要整合sillytavern平台的内部事件系统（如 MESSAGE_RENDERED, STREAM_TOKEN_RECEIVED 等），能够精确地在消息出现、更新、删除或实时生成时触发相应的功能。
---
在显示图片和立绘上，代码会为复杂的图片提供完整的url，其地址为`https://gitgud.io/RBQ/amakano3/-/raw/master/${文件名字}`。例如“角色1|L1|illu_1|你好，我叫“角色1”[action|角色1|jump_up]”中立绘“illu_1”对应地址为“https://gitgud.io/RBQ/amakano3/-/raw/master/illu_1.png”、[cg|CG1]中CG1地址为“https://gitgud.io/RBQ/amakano3/-/raw/master/CG1.png”、[bgm|bgm_1]中“bgm_1”地址为“https://gitgud.io/RBQ/amakano3/-/raw/master/bgm_1.mp3”

---
任务：阅读现有规则, 设计代码完成我们说的功能。在src\gal文件中中编写代码。我已经为你准备好了三个工作文件。你的工作流程和解释需要用中文告诉我。

代码设计方面，文件夹“优秀事例”内有其他类似类似的的优秀作品，在代码实现层面可以参考如下:
异世界和平:请你**参考这个代码**设计，这个代码有许多功能可以直接照搬，例如界面图标位置摆放、美术设计、功能实现
蔚蓝档案-铁道双子篇：这个代码可以提供打字机效果的实现和立绘位置处理的功能实现、角色动画实现、不同角色说话时候其他角色“变暗”的功能
galgame_interface：“隐藏与显示”功能

美术设计方面：
“样例”文件夹内有多张我中意的美术界面风格，你可以学习其中的美术设计（比如图标的位置、整体颜色等）。注意，有些界面左上角有日文，那就是我想要的“音乐显示”美术设计。